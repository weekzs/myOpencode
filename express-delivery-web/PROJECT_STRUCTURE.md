# é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†é¡¹ç›®çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
express-delivery-web/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                    # é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md         # é¡¹ç›®ç»“æ„è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ ğŸ“„ start.bat                    # Windowsä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ ğŸ“„ env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ docs/                        # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README.md                   # æ–‡æ¡£ç´¢å¼•
â”‚   â”œâ”€â”€ PAYMENT_SETUP.md            # æ”¯ä»˜ç³»ç»Ÿé…ç½®
â”‚   â”œâ”€â”€ WECHAT_PAY_SETUP.md         # å¾®ä¿¡æ”¯ä»˜é…ç½®
â”‚   â””â”€â”€ PAYMENT_AND_ADDRESS_FEATURES.md  # åŠŸèƒ½ç‰¹æ€§è¯´æ˜
â”‚
â”œâ”€â”€ ğŸ“ frontend/                    # å‰ç«¯åº”ç”¨ï¼ˆNext.jsï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ package.json            # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ tsconfig.json            # TypeScripté…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ next.config.ts           # Next.jsé…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ start-frontend.bat       # å‰ç«¯å¯åŠ¨è„šæœ¬
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ app/                 # Next.js App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ layout.tsx       # æ ¹å¸ƒå±€
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ page.tsx         # é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/            # è®¤è¯ç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ register/page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ order/           # è®¢å•åˆ›å»ºé¡µé¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ orders/           # è®¢å•åˆ—è¡¨å’Œè¯¦æƒ…
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # è®¢å•åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/page.tsx   # è®¢å•è¯¦æƒ…
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ profile/          # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/          # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ ui/              # UIç»„ä»¶åº“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AddressSelector.tsx      # åœ°å€é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BackButton.tsx          # è¿”å›æŒ‰é’®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx               # æŒ‰é’®ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx                 # å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx                # è¾“å…¥æ¡†ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NativeLocationPicker.tsx # åœ°å›¾é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PaymentModal.tsx         # æ”¯ä»˜å¼¹çª—
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ layout/          # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ hooks/               # React Hooks
â”‚   â”‚   â”‚   â””â”€â”€ useAuth.ts          # è®¤è¯Hook
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ types/               # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ index.ts            # ç±»å‹å¯¼å‡º
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ api.ts              # APIå®¢æˆ·ç«¯
â”‚   â”‚       â””â”€â”€ auth.ts             # è®¤è¯å·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ public/                  # é™æ€èµ„æº
â”‚
â”œâ”€â”€ ğŸ“ backend/                     # åç«¯æœåŠ¡ï¼ˆExpress.jsï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ package.json             # åç«¯ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ tsconfig.json            # TypeScripté…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ start-backend.bat       # åç«¯å¯åŠ¨è„šæœ¬
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ server.ts            # æœåŠ¡å™¨å…¥å£æ–‡ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ controllers/         # æ§åˆ¶å™¨ï¼ˆè·¯ç”±å¤„ç†å™¨ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ addressController.ts    # åœ°å€æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ orderController.ts      # è®¢å•æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ paymentController.ts     # æ”¯ä»˜æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ reviewController.ts      # è¯„ä»·æ§åˆ¶å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ routes/              # APIè·¯ç”±å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ addresses.ts        # åœ°å€è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ orders.ts            # è®¢å•è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ payments.ts         # æ”¯ä»˜è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ reviews.ts          # è¯„ä»·è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ stations.ts         # å¿«é€’ç«™è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ uploads.ts          # æ–‡ä»¶ä¸Šä¼ è·¯ç”±
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ services/            # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ addressService.ts        # åœ°å€æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ mockPaymentService.ts     # æ¨¡æ‹Ÿæ”¯ä»˜æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ orderService.ts           # è®¢å•æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ paymentService.ts         # é€šç”¨æ”¯ä»˜æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ reviewService.ts          # è¯„ä»·æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ wechatPayService.ts       # å¾®ä¿¡æ”¯ä»˜æœåŠ¡
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ middleware/           # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ errorHandler.ts     # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ prisma/                  # Prismaæ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ schema.prisma           # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ seed.ts                 # æ•°æ®åº“ç§å­æ•°æ®
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ dist/                    # TypeScriptç¼–è¯‘è¾“å‡ºï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ ğŸ“ uploads/                  # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚
â””â”€â”€ ğŸ“ 1738582376_20260121_cert/    # å¾®ä¿¡æ”¯ä»˜è¯ä¹¦ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ apiclient_key.pem            # ç§é’¥æ–‡ä»¶
    â”œâ”€â”€ apiclient_cert.pem           # è¯ä¹¦æ–‡ä»¶
    â””â”€â”€ 32å­—ç¬¦ä¸².txt                 # å¯†é’¥æ–‡ä»¶
```

## ğŸ“ æ–‡ä»¶è¯´æ˜

### æ ¹ç›®å½•æ–‡ä»¶

- **README.md**: é¡¹ç›®ä¸»æ–‡æ¡£ï¼ŒåŒ…å«å¿«é€Ÿå¼€å§‹æŒ‡å—
- **PROJECT_STRUCTURE.md**: é¡¹ç›®ç»“æ„è¯¦ç»†è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
- **start.bat**: Windowsä¸€é”®å¯åŠ¨è„šæœ¬
- **env.example**: ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

### å‰ç«¯æ–‡ä»¶ç»“æ„

#### `frontend/src/app/`
Next.js App Routeré¡µé¢ç›®å½•ï¼š
- **layout.tsx**: æ ¹å¸ƒå±€ç»„ä»¶
- **page.tsx**: é¦–é¡µ
- **auth/**: è®¤è¯ç›¸å…³é¡µé¢ï¼ˆç™»å½•/æ³¨å†Œï¼‰
- **order/**: è®¢å•åˆ›å»ºé¡µé¢
- **orders/**: è®¢å•åˆ—è¡¨å’Œè¯¦æƒ…é¡µé¢
- **profile/**: ä¸ªäººä¸­å¿ƒé¡µé¢

#### `frontend/src/components/ui/`
å¯å¤ç”¨çš„UIç»„ä»¶ï¼š
- **AddressSelector.tsx**: åœ°å€å†å²è®°å½•é€‰æ‹©å™¨
- **PaymentModal.tsx**: æ”¯ä»˜ç¡®è®¤å¼¹çª—
- **NativeLocationPicker.tsx**: åœ°å›¾åœ°å€é€‰æ‹©å™¨
- **Button.tsx, Card.tsx, Input.tsx**: åŸºç¡€UIç»„ä»¶

#### `frontend/src/utils/`
å·¥å…·å‡½æ•°å’ŒAPIå®¢æˆ·ç«¯ï¼š
- **api.ts**: APIè¯·æ±‚å°è£…ï¼ŒåŒ…å«æ‰€æœ‰APIè°ƒç”¨æ–¹æ³•
- **auth.ts**: è®¤è¯ç›¸å…³å·¥å…·å‡½æ•°

### åç«¯æ–‡ä»¶ç»“æ„

#### `backend/src/controllers/`
æ§åˆ¶å™¨å±‚ï¼Œå¤„ç†HTTPè¯·æ±‚ï¼š
- **addressController.ts**: åœ°å€ç›¸å…³APIå¤„ç†
- **orderController.ts**: è®¢å•ç›¸å…³APIå¤„ç†
- **paymentController.ts**: æ”¯ä»˜ç›¸å…³APIå¤„ç†
- **reviewController.ts**: è¯„ä»·ç›¸å…³APIå¤„ç†

#### `backend/src/services/`
ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚ï¼š
- **mockPaymentService.ts**: æ¨¡æ‹Ÿæ”¯ä»˜æœåŠ¡ï¼ˆæ— éœ€ç¬¬ä¸‰æ–¹å¹³å°ï¼‰
- **paymentService.ts**: é€šç”¨æ”¯ä»˜æœåŠ¡ï¼ˆæ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼‰
- **wechatPayService.ts**: å¾®ä¿¡æ”¯ä»˜æœåŠ¡
- **addressService.ts**: åœ°å€ç®¡ç†æœåŠ¡
- **orderService.ts**: è®¢å•ç®¡ç†æœåŠ¡

#### `backend/src/routes/`
APIè·¯ç”±å®šä¹‰ï¼š
- å®šä¹‰æ‰€æœ‰APIç«¯ç‚¹çš„è·¯ç”±
- è¿æ¥æ§åˆ¶å™¨å’Œä¸­é—´ä»¶

#### `backend/prisma/`
æ•°æ®åº“é…ç½®ï¼š
- **schema.prisma**: æ•°æ®åº“æ¨¡å‹å®šä¹‰ï¼ˆUser, Order, Paymentç­‰ï¼‰
- **seed.ts**: æ•°æ®åº“ç§å­æ•°æ®ï¼ˆåˆå§‹æ•°æ®ï¼‰

## ğŸ”„ æ•°æ®æµ

### è¯·æ±‚æµç¨‹
```
å‰ç«¯é¡µé¢ â†’ APIè°ƒç”¨ (utils/api.ts) 
    â†’ åç«¯è·¯ç”± (routes/*.ts) 
    â†’ è®¤è¯ä¸­é—´ä»¶ (middleware/auth.ts)
    â†’ æ§åˆ¶å™¨ (controllers/*.ts)
    â†’ æœåŠ¡å±‚ (services/*.ts)
    â†’ æ•°æ®åº“ (Prisma)
```

### å“åº”æµç¨‹
```
æ•°æ®åº“ (Prisma) 
    â†’ æœåŠ¡å±‚ (services/*.ts)
    â†’ æ§åˆ¶å™¨ (controllers/*.ts)
    â†’ JSONå“åº”
    â†’ å‰ç«¯å¤„ç† (components/pages)
```

## ğŸ“¦ ä¾èµ–ç®¡ç†

### å‰ç«¯ä¸»è¦ä¾èµ–
- **next**: Next.jsæ¡†æ¶
- **react**: Reactåº“
- **typescript**: TypeScriptæ”¯æŒ
- **tailwindcss**: CSSæ¡†æ¶

### åç«¯ä¸»è¦ä¾èµ–
- **express**: Express.jsæ¡†æ¶
- **prisma**: ORMæ•°æ®åº“å·¥å…·
- **jsonwebtoken**: JWTè®¤è¯
- **bcryptjs**: å¯†ç åŠ å¯†
- **wechatpay-node-v3**: å¾®ä¿¡æ”¯ä»˜SDKï¼ˆå¯é€‰ï¼‰

## ğŸ¯ å…³é”®è®¾è®¡æ¨¡å¼

### 1. MVCæ¶æ„
- **Model**: Prismaæ•°æ®åº“æ¨¡å‹
- **View**: Next.jså‰ç«¯é¡µé¢
- **Controller**: Expressè·¯ç”±æ§åˆ¶å™¨

### 2. æœåŠ¡å±‚æ¨¡å¼
ä¸šåŠ¡é€»è¾‘å°è£…åœ¨æœåŠ¡å±‚ï¼Œæ§åˆ¶å™¨åªè´Ÿè´£HTTPè¯·æ±‚å¤„ç†

### 3. ä¸­é—´ä»¶æ¨¡å¼
- è®¤è¯ä¸­é—´ä»¶ï¼šéªŒè¯JWT token
- é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**: æ•æ„Ÿé…ç½®ï¼ˆæ•°æ®åº“å¯†ç ã€JWTå¯†é’¥ç­‰ï¼‰å­˜å‚¨åœ¨`.env`æ–‡ä»¶ä¸­ï¼Œä¸è¦æäº¤åˆ°ä»£ç åº“
2. **ç¼–è¯‘è¾“å‡º**: `backend/dist/`ç›®å½•æ˜¯TypeScriptç¼–è¯‘è¾“å‡ºï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ
3. **è¯ä¹¦æ–‡ä»¶**: å¾®ä¿¡æ”¯ä»˜è¯ä¹¦æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦æäº¤åˆ°ä»£ç åº“
4. **ä¸Šä¼ æ–‡ä»¶**: `backend/uploads/`ç›®å½•å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶

## ğŸ” æŸ¥æ‰¾æ–‡ä»¶æŒ‡å—

- **æƒ³ä¿®æ”¹APIæ¥å£ï¼Ÿ** â†’ `backend/src/routes/` å’Œ `backend/src/controllers/`
- **æƒ³ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ï¼Ÿ** â†’ `backend/src/services/`
- **æƒ³ä¿®æ”¹å‰ç«¯é¡µé¢ï¼Ÿ** â†’ `frontend/src/app/`
- **æƒ³ä¿®æ”¹UIç»„ä»¶ï¼Ÿ** â†’ `frontend/src/components/ui/`
- **æƒ³ä¿®æ”¹æ•°æ®åº“æ¨¡å‹ï¼Ÿ** â†’ `backend/prisma/schema.prisma`
- **æƒ³æŸ¥çœ‹APIè°ƒç”¨ï¼Ÿ** â†’ `frontend/src/utils/api.ts`
